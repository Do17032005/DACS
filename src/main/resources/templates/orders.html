<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <div th:replace="~{fragments/head :: head}"></div>
    <title>ƒê∆°n h√†ng c·ªßa t√¥i | CANIFA</title>
</head>

<body>
    <div th:replace="~{fragments/header :: header}"></div>

    <nav class="breadcrumb">
        <div class="breadcrumb-list"><a th:href="@{/}">Trang ch·ªß</a><span class="breadcrumb-separator">‚Ä∫</span><a
                th:href="@{/profile}">T√†i kho·∫£n</a><span class="breadcrumb-separator">‚Ä∫</span><span
                class="breadcrumb-current">ƒê∆°n h√†ng</span></div>
    </nav>

    <div class="profile-container">
        <aside class="profile-sidebar">
            <div class="sidebar-user-info">
                <div class="sidebar-avatar">üë§</div>
                <p class="sidebar-greeting">Xin ch√†o!</p>
                <p class="sidebar-name" id="userName" th:text="${user?.fullName ?: 'Kh√°ch h√†ng'}">Kh√°ch h√†ng</p>
                <div class="sidebar-member-level"><span class="member-badge"></span><span>H·∫°ng Green</span></div>
            </div>
            <nav class="sidebar-menu">
                <a th:href="@{/profile}" class="sidebar-menu-item"><svg viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg><span>Th√¥ng tin t√†i kho·∫£n</span></a>
                <a th:href="@{/vouchers}" class="sidebar-menu-item"><svg viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5">
                        <path d="M21 5H3a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg><span>M√£ ∆∞u ƒë√£i</span><span class="badge">2</span></a>
                <a th:href="@{/orders}" class="sidebar-menu-item active"><svg viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <path d="M16 10a4 4 0 0 1-8 0"></path>
                    </svg><span>ƒê∆°n h√†ng</span></a>
                <a th:href="@{/membership}" class="sidebar-menu-item"><svg viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5">
                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                        <line x1="1" y1="10" x2="23" y2="10"></line>
                    </svg><span>Th·∫ª th√†nh vi√™n</span></a>
                <a th:href="@{/address}" class="sidebar-menu-item"><svg viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg><span>S·ªï ƒë·ªãa ch·ªâ</span></a>
                <form th:action="@{/logout}" method="post" style="margin: 0;">
                    <button type="submit" class="sidebar-menu-item logout" style="width: 100%; border: none; background: none; font: inherit; cursor: pointer; text-align: left;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        <span>ƒêƒÉng xu·∫•t</span>
                    </button>
                </form>
            </nav>
        </aside>

        <main class="profile-content">
            <div class="profile-header">
                <h1 class="profile-title">ƒê∆†N H√ÄNG C·ª¶A T√îI</h1>
            </div>

            <div class="order-tabs">
                <button class="order-tab active" data-status="all">T·∫•t c·∫£</button>
                <button class="order-tab" data-status="PENDING">Ch·ªù x√°c nh·∫≠n</button>
                <button class="order-tab" data-status="PROCESSING">ƒêang x·ª≠ l√Ω</button>
                <button class="order-tab" data-status="SHIPPING">ƒêang giao</button>
                <button class="order-tab" data-status="DELIVERED">ƒê√£ giao</button>
                <button class="order-tab" data-status="CANCELLED">ƒê√£ h·ªßy</button>
            </div>

            <div id="ordersContainer">
                <div th:if="${#lists.isEmpty(orders)}" class="empty-state" id="emptyState">
                    <h3>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</h3>
                    <a th:href="@{/products}" class="btn-shop">Mua s·∫Øm ngay</a>
                </div>
                <!-- Dynamic Orders -->
                <div class="order-card" th:each="order : ${orders}" th:data-status="${order.status}">
                    <div class="order-header">
                        <div>
                            <span class="order-id" th:text="'#' + ${order.orderCode}">#ORD123ABC</span>
                            <span class="order-date"
                                th:text="' ‚Ä¢ ' + ${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}"> ‚Ä¢
                                16/01/2026</span>
                        </div>
                        <span class="order-status" 
                              th:classappend="${order.status.name() == 'PENDING' ? 'pending' : 
                                               (order.status.name() == 'CONFIRMED' ? 'confirmed' :
                                               (order.status.name() == 'PROCESSING' ? 'processing' :
                                               (order.status.name() == 'SHIPPING' ? 'shipping' :
                                               (order.status.name() == 'DELIVERED' ? 'delivered' : 'cancelled'))))}"
                              th:text="${order.status.name() == 'PENDING' ? 'Ch·ªù x√°c nh·∫≠n' : 
                                        (order.status.name() == 'CONFIRMED' ? 'ƒê√£ x√°c nh·∫≠n' :
                                        (order.status.name() == 'PROCESSING' ? 'ƒêang x·ª≠ l√Ω' :
                                        (order.status.name() == 'SHIPPING' ? 'ƒêang giao' :
                                        (order.status.name() == 'DELIVERED' ? 'ƒê√£ giao' : 'ƒê√£ h·ªßy'))))}">ƒê√£ giao</span>
                    </div>
                    <div class="order-footer">
                        <div class="order-total">T·ªïng ti·ªÅn: <span
                                th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT') + 'ƒë'}">299,000ƒë</span>
                        </div>
                        <a th:href="@{/orders/{id}(id=${order.id})}" class="btn-view-order">Xem chi ti·∫øt</a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabs = document.querySelectorAll('.order-tab');
            const orderCards = document.querySelectorAll('.order-card');
            const emptyState = document.getElementById('emptyState');

            // Tab switching and filtering
            tabs.forEach(tab => {
                tab.addEventListener('click', function () {
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');

                    const status = this.dataset.status;
                    let visibleCount = 0;

                    // Filter orders
                    orderCards.forEach(card => {
                        const cardStatus = card.dataset.status;
                        if (status === 'all' || cardStatus === status) {
                            card.style.display = 'block';
                            visibleCount++;
                        } else {
                            card.style.display = 'none';
                        }
                    });

                    // Show/hide empty state
                    if (emptyState) {
                        if (visibleCount === 0) {
                            emptyState.style.display = 'block';
                            emptyState.querySelector('h3').textContent = 
                                status === 'all' ? 'Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o' : 'Kh√¥ng c√≥ ƒë∆°n h√†ng ' + this.textContent.toLowerCase();
                        } else {
                            emptyState.style.display = 'none';
                        }
                    }
                });
            });
        });
    </script>
</body>

</html>