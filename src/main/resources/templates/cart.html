<head>
    <div th:replace="~{fragments/head :: head}"></div>
    <title>Gi·ªè h√†ng | CANIFA</title>
</head>

<body>
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="cart-page">
        <h1>üõí Gi·ªè h√†ng c·ªßa b·∫°n</h1>
        <div class="cart-container" id="cartContainer">
            <div class="cart-items" id="cartItems"></div>
            <div class="cart-summary">
                <h2 class="summary-title">T√≥m t·∫Øt ƒë∆°n h√†ng</h2>
                <div class="coupon-section">
                    <div class="coupon-input"><input type="text" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°"><button
                            class="btn-apply">√Åp d·ª•ng</button></div>
                </div>
                <div class="summary-row"><span>T·∫°m t√≠nh</span><span id="subtotal">0ƒë</span></div>
                <div class="summary-row"><span>Ph√≠ v·∫≠n chuy·ªÉn</span><span id="shipping">Mi·ªÖn ph√≠</span></div>
                <div class="summary-row"><span>Gi·∫£m gi√°</span><span id="discount">0ƒë</span></div>
                <div class="summary-row total"><span>T·ªïng c·ªông</span><span class="value" id="total">0ƒë</span></div>
                <button class="btn-checkout" onclick="goToCheckout()">Ti·∫øn h√†nh thanh to√°n</button>
                <a href="products.html" class="continue-shopping">‚Üê Ti·∫øp t·ª•c mua s·∫Øm</a>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>
    <script>
        function renderCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const container = document.getElementById('cartItems');

            if (cart.length === 0) {
                document.getElementById('cartContainer').innerHTML = `<div class="empty-cart"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg><h2>Gi·ªè h√†ng tr·ªëng</h2><p>B·∫°n ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong gi·ªè h√†ng</p><a href="/products" class="btn-shop">Mua s·∫Øm ngay</a></div>`;
                return;
            }

            let html = `<div class="cart-header"><span>S·∫£n ph·∫©m</span><span>ƒê∆°n gi√°</span><span>S·ªë l∆∞·ª£ng</span><span>Th√†nh ti·ªÅn</span><span></span></div>`;
            let subtotal = 0;

            cart.forEach((item, index) => {
                const itemTotal = item.price * item.qty;
                subtotal += itemTotal;
                html += `<div class="cart-item"><div class="item-info"><div class="item-image"><img src="${item.image}"></div><div class="item-details"><h3>${item.name}</h3><p class="item-variant">M√†u: ${item.color} | Size: ${item.size}</p></div></div><div class="item-price">${item.price.toLocaleString()}ƒë</div><div class="quantity-control"><button class="qty-btn" onclick="updateQty(${index},-1)">-</button><input type="number" class="qty-input" value="${item.qty}" readonly><button class="qty-btn" onclick="updateQty(${index},1)">+</button></div><div class="item-total">${itemTotal.toLocaleString()}ƒë</div><button class="btn-remove" onclick="removeItem(${index})">‚úï</button></div>`;
            });

            container.innerHTML = html;
            document.getElementById('subtotal').textContent = subtotal.toLocaleString() + 'ƒë';
            document.getElementById('total').textContent = subtotal.toLocaleString() + 'ƒë';
        }

        function updateQty(index, delta) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart[index].qty = Math.max(1, cart[index].qty + delta);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
        }

        function removeItem(index) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            renderCart();
            showToast('ƒê√£ x√≥a s·∫£n ph·∫©m', 'success');
        }

        function goToCheckout() { window.location.href = '/checkout'; }
        renderCart();
    </script>
</body>

</html>