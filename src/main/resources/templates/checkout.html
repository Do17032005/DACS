<head>
    <div th:replace="~{fragments/head :: head}"></div>
    <title>Thanh to√°n | CANIFA</title>
</head>

<body>
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="checkout-page">
        <!-- ... existing content remains same ... -->
        <h1>Thanh to√°n</h1>
        <div class="checkout-container">
            <!-- ... existing container content ... -->
            <div class="checkout-form">
                <div class="form-section">
                    <h2 class="section-title"><span class="section-number">1</span>Th√¥ng tin giao h√†ng</h2>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">H·ªç t√™n *</label><input type="text"
                                class="form-control" placeholder="Nh·∫≠p h·ªç t√™n" id="fullName"></div>
                        <div class="form-group"><label class="form-label">S·ªë ƒëi·ªán tho·∫°i *</label><input type="tel"
                                class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" id="phone"></div>
                    </div>
                    <div class="form-group"><label class="form-label">Email</label><input type="email"
                            class="form-control" placeholder="Nh·∫≠p email" id="email"></div>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">T·ªânh/Th√†nh ph·ªë *</label>
                            <select class="form-control">
                                <option>Ch·ªçn T·ªânh/Th√†nh ph·ªë</option>
                                <option>TP. H·ªì Ch√≠ Minh</option>
                                <option>H√† N·ªôi</option>
                                <option>ƒê√† N·∫µng</option>
                            </select>
                        </div>
                        <div class="form-group"><label class="form-label">Qu·∫≠n/Huy·ªán *</label>
                            <select class="form-control">
                                <option>Ch·ªçn Qu·∫≠n/Huy·ªán</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group"><label class="form-label">ƒê·ªãa ch·ªâ chi ti·∫øt *</label><input type="text"
                            class="form-control" placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng, ph∆∞·ªùng/x√£"></div>
                    <div class="form-group"><label class="form-label">Ghi ch√∫</label><textarea class="form-control"
                            rows="3" placeholder="Ghi ch√∫ cho ƒë∆°n h√†ng (n·∫øu c√≥)"></textarea></div>
                </div>

                <div class="form-section">
                    <h2 class="section-title"><span class="section-number">2</span>Ph∆∞∆°ng th·ª©c thanh to√°n</h2>
                    <div class="payment-methods">
                        <label class="payment-option active"><input type="radio" name="payment" value="cod" checked><img
                                src="https://cdn-icons-png.flaticon.com/128/2331/2331970.png" class="payment-logo"
                                style="height:35px">
                            <div class="payment-info">
                                <div class="payment-name">Thanh to√°n khi nh·∫≠n h√†ng (COD)</div>
                                <div class="payment-desc">Thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</div>
                            </div>
                        </label>
                        <label class="payment-option"><input type="radio" name="payment" value="vnpay"><img
                                src="https://vnpay.vn/assets/images/logo-icon/logo-primary.svg" class="payment-logo">
                            <div class="payment-info">
                                <div class="payment-name">V√≠ VNPAY / QR Code</div>
                                <div class="payment-desc">Thanh to√°n qua v√≠ ƒëi·ªán t·ª≠ VNPAY</div>
                            </div>
                        </label>
                        <label class="payment-option"><input type="radio" name="payment" value="momo"><img
                                src="https://upload.wikimedia.org/wikipedia/vi/f/fe/MoMo_Logo.png" class="payment-logo">
                            <div class="payment-info">
                                <div class="payment-name">V√≠ MoMo</div>
                                <div class="payment-desc">Thanh to√°n qua v√≠ ƒëi·ªán t·ª≠ MoMo</div>
                            </div>
                        </label>
                        <label class="payment-option"><input type="radio" name="payment" value="bank"><img
                                src="https://cdn-icons-png.flaticon.com/128/2830/2830284.png" class="payment-logo"
                                style="height:35px">
                            <div class="payment-info">
                                <div class="payment-name">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</div>
                                <div class="payment-desc">Chuy·ªÉn kho·∫£n tr·ª±c ti·∫øp qua t√†i kho·∫£n ng√¢n h√†ng</div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <div class="order-summary">
                <h2 class="summary-title">ƒê∆°n h√†ng c·ªßa b·∫°n</h2>
                <div class="order-items" id="orderItems"></div>
                <div class="summary-row"><span>T·∫°m t√≠nh</span><span id="subtotal">0ƒë</span></div>
                <div class="summary-row"><span>Ph√≠ v·∫≠n chuy·ªÉn</span><span>Mi·ªÖn ph√≠</span></div>
                <div class="summary-row total"><span>T·ªïng c·ªông</span><span class="value" id="total">0ƒë</span></div>
                <button class="btn-place-order" onclick="placeOrder()">üîí ƒê·∫∑t h√†ng</button>
                <p class="secure-badge">üîê Thanh to√°n an to√†n & b·∫£o m·∫≠t</p>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>
    <script>
        function renderOrderItems() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (cart.length === 0) { window.location.href = '/cart'; return; }
            let html = '', subtotal = 0;
            cart.forEach(item => {
                const itemTotal = item.price * item.qty;
                subtotal += itemTotal;
                html += `<div class="order-item"><div class="order-item-img"><img src="${item.image}"></div><div class="order-item-info"><div class="order-item-name">${item.name}</div><div class="order-item-variant">${item.color} / ${item.size} x${item.qty}</div></div><div class="order-item-price">${itemTotal.toLocaleString()}ƒë</div></div>`;
            });
            document.getElementById('orderItems').innerHTML = html;
            document.getElementById('subtotal').textContent = subtotal.toLocaleString() + 'ƒë';
            document.getElementById('total').textContent = subtotal.toLocaleString() + 'ƒë';
        }

        document.querySelectorAll('.payment-option').forEach(option => {
            option.addEventListener('click', function () {
                document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
            });
        });

        function placeOrder() {
            const name = document.getElementById('fullName').value;
            const phone = document.getElementById('phone').value;
            if (!name || !phone) { showToast('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin', 'error'); return; }

            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;

            if (paymentMethod === 'vnpay') {
                showToast('ƒêang chuy·ªÉn ƒë·∫øn VNPAY...', 'info');
                setTimeout(() => { alert('Demo: Chuy·ªÉn h∆∞·ªõng ƒë·∫øn c·ªïng thanh to√°n VNPAY'); processOrder(); }, 1500);
            } else if (paymentMethod === 'momo') {
                showToast('ƒêang chuy·ªÉn ƒë·∫øn MoMo...', 'info');
                setTimeout(() => { alert('Demo: Chuy·ªÉn h∆∞·ªõng ƒë·∫øn ·ª©ng d·ª•ng MoMo'); processOrder(); }, 1500);
            } else {
                processOrder();
            }
        }

        function processOrder() {
            localStorage.removeItem('cart');
            showToast('ƒê·∫∑t h√†ng th√†nh c√¥ng! C·∫£m ∆°n b·∫°n ƒë√£ mua h√†ng', 'success');
            setTimeout(() => { window.location.href = '/order-success'; }, 2000);
        }

        // Pre-fill user info
        const user = JSON.parse(localStorage.getItem('canifaUser'));
        if (user) {
            document.getElementById('fullName').value = user.name || '';
            document.getElementById('phone').value = user.phone || '';
            document.getElementById('email').value = user.email || '';
        }

        renderOrderItems();
    </script>
</body>

</html>